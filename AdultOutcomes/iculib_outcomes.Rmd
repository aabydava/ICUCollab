---
title: "ICU Liberation: ABCDEF Bundle vs ICU Outcomes"
author: "Jennifer Thompson, MPH for Society of Critical Care Medicine"
output:
  html_notebook:
    code_folding: hide
    theme: journal
    toc: true
    toc_float: true
    toc_depth: 2
---

```{r setup}
library(tidyverse, quietly = TRUE)
library(rms, quietly = TRUE)
library(captioner, quietly = TRUE)

load("AnalysisData/iculib.Rdata")

```

```{r tablesfigs, results = "hide"}
table_nums <- captioner(prefix = "Table")
table_nums(
  name = "descbase", caption = "Baseline and Demographic Characteristics"
)
table_nums(
  name = "descinhosp", caption = "In-Hospital and Discharge Characteristics"
)
table_nums(name = "descicudays", caption = "ICU Day Characteristics")
table_nums(
  name = "descabcdef", caption = "Bundle Compliance and Performance, Overall"
)

figure_nums <- captioner(prefix = "Figure")

```

# Overview & Purpose

This report aims to:

1. Describe the cohort of patients in the [SCCM ICU Liberation ABCDEF Bundle Improvement Collaborative](http://www.iculiberation.org/About/collaborative/Pages/default.aspx)
1. Describe the implementation of the [ABCDEF Bundle](http://www.iculiberation.org/Bundles/Pages/default.aspx) over the course of the Collaborative
1. Describe the association between compliance and performance of the ABCDEF Bundle and important ICU outcomes *(outcomes will be detailed in a later section)*

The Collaborative enrolled patients at `r length(unique(demog$hosp_f))` ICUs
across the United States, collecting data during a six-month **baseline** period
and a 14-month **implementation** period. During the six months of baseline data
collection, no changes in usual care were prescribed; during the 14 months of
implementation, sites were encouraged to use the ABCDEF Bundle. Our hypotheses
are that implementation rates improved over the course of data collection, and
that increased compliance with and performance of the ABCDEF Bundle is
associated with better in-hospital outcomes.

Our analysis plan was specified *a priori* and can be found [here](https://docs.google.com/document/d/1GebrA6Lt-rEh70Aw9r4mrhRlggWUfgUl_LaQePOCWZA/edit?usp=sharing), including a history of all changes.

# Definitions of Compliance and Performance {#definitions}

There are six main elements of the ABCDEF Bundle, with element B comprised of
two main components. Definitions of "compliance" (completely following the ABCDEF Bundle protocol as specified, with documentation of each step) and "performance" (performing the main component of the Bundle element, possibly without complete documentation) are detailed below, referring to any single day. For each element,
compliance and performance are only measured if the patient was in the ICU the
full 24 hours; additional eligibility for specific elements are detailed below.

| Bundle element    | Days eligible | Compliant if: | Performed if: |
|-------------------|---------------|---------------|---------------|
| **A: Assess, prevent and manage pain**  | | >=6 documented pain assessments using a validated instrument | *same* |
| **B: Both SAT and SBT** |   |   |   |
| &nbsp;&nbsp;&nbsp;SAT | Received continuous/ intermittent sedation | **If safety screen documented:**<br>If screen failed, SAT not performed; if screen passed, SAT was performed<br>**If safety screen not documented:**<br>SAT marked not done due to  failed screen/contraindication | SAT performed and documented |
| &nbsp;&nbsp;&nbsp;SBT | On mechanical ventilation | **If safety screen documented:**<br>If screen failed, SBT not performed; if screen passed, SBT was performed<br>**If safety screen not documented:**<br>SBT marked not done due to  failed screen/contraindication | SBT performed and documented |
| **C: Choice of analgesia and sedation** | | >=6 documented sedation assessments using a validated instrument | *same* |
| **D: Delirium - assess, prevent and manage** | | >=2 documented delirium assessments using a validated instrument | *same* |
| **E: Exercise and early mobility** | | **If safety screen documented:**<br>If screen failed, mobility not performed; if screen passed, mobility higher than active range of motion was performed<br>**If safety screen not documented:**<br>Mobility marked not done due to failed screen/contraindication | Mobility higher than active range of motion performed and documented |
| **F: Family engagement and empowerment** | Family present | Family member was educated on ABCDEF bundle and/or participated in at least one of: rounds; conference; plan of care; ABCDEF care | *same* |
| **Overall (complete)** | | All elements eligible to be compliant are compliant | All elements eligible to be performed are performed |
| **Overall (dose)** | | Elements compliant / elements eligible to be compliant | Elements performed / elements eligible to be performed |

# Description of Cohort

`r table_nums("descbase", display = "cite")` describes the demographic and ICU admission characteristics of the patients enrolled during Months 1-20 of data
collection; `r table_nums("descinhosp", display = "cite")` describes in-hospital and discharge characteristics. **Note:** Only patients with at least one day fully in the ICU will be included in the analyses; this reduces the total N to
`r format(sum(demog$icu_days > 0, na.rm = TRUE), big.mark = ",")` patients.

For full definitions of compliance and performance, see [Definitions](#definitions).

```{r descbase}
## Add labels to variables we want to describe - labels don't play well with
## tidyverse so copy a separate data.frame
demog_desc <- demog
label(demog_desc$age_f) <- "Age category"
label(demog_desc$sex_f) <- "Sex"
label(demog_desc$race_cat) <- "Race"
label(demog_desc$hisp_cat) <- "Hispanic"
label(demog_desc$bmi) <- "BMI"
label(demog_desc$home_preadmit) <- "Residence pre-admission"
label(demog_desc$mob_preadmit) <- "Mobility pre-admission"
label(demog_desc$primary_admit) <- "Primary admission diagnosis"
label(demog_desc$icu_type_comb) <- "ICU type"
label(demog_desc$any_soi) <- "Any severity of illness score available"
label(demog_desc$apacheii_avail) <- "APACHE II available"
label(demog_desc$apacheii_score) <- "APACHE II score"
label(demog_desc$apacheiii_avail) <- "APACHE III available"
label(demog_desc$apacheiii_score) <- "APACHE III score"
label(demog_desc$apacheiv_avail) <- "APACHE IV available"
label(demog_desc$apacheiv_score) <- "APACHE IV score"
label(demog_desc$sofa_avail) <- "SOFA available"
label(demog_desc$sofa_score) <- "SOFA score"
label(demog_desc$othersoi_avail) <- "Other SOI available"
label(demog_desc$ever_invas_mv) <- "Ever on invasive MV"
label(demog_desc$hrs_invas_mv) <- "Hours on invasive MV"
label(demog_desc$ever_noninvas_mv) <- "Ever on noninvasive MV"
label(demog_desc$hrs_noninvas_mv) <- "Hours on noninvasive MV"
label(demog_desc$icu_los) <- "ICU length of stay"
label(demog_desc$icu_days) <- "Days all 24h in ICU"
label(demog_desc$ever_readmit_icu) <- "Ever readmitted to ICU"
label(demog_desc$sigpain_icu_days) <- "Days in ICU with significant pain"
label(demog_desc$on_sedation_icu_days) <-
  "Days in ICU on continuous/intermittent sedation"
label(demog_desc$had_satscreen_icu_days) <- "Days in ICU with SAT safety screen"
label(demog_desc$had_sat_icu_days) <- "Days in ICU with SAT performed"
label(demog_desc$on_mv_icu_days) <- "Days in ICU on MV"
label(demog_desc$had_sbtscreen_icu_days) <- "Days in ICU with SBT safety screen"
label(demog_desc$had_sbt_icu_days) <- "Days in ICU with SBT performed"
label(demog_desc$sat_sbt_icu_days) <- "Days in ICU with SAT prior to SBT"
label(demog_desc$rcvd_benzo_icu_days) <- "Days received benzodiazepines in ICU"
label(demog_desc$rcvd_opioid_icu_days) <- "Days received opioids in ICU"
label(demog_desc$rcvd_propofol_icu_days) <- "Days received propofol in ICU"
label(demog_desc$rcvd_dex_icu_days) <- "Days received dex in ICU"
label(demog_desc$had_sedasmt_icu_days) <-
  "Days in ICU with >=1 sedation assessment"
label(demog_desc$had_delasmt_icu_days) <-
  "Days in ICU with >=1 delirium assessment"
label(demog_desc$delirium_icu_days) <- "Days in ICU with delirium"
label(demog_desc$had_mobscreen_icu_days) <-
  "Days in ICU with mobility safety screen"
label(demog_desc$had_mobility_icu_days) <-
  "Days in ICU with mobility performed (> active ROM)"
label(demog_desc$family_present_icu_days) <- "Days in ICU with family present"
label(demog_desc$family_invited_icu_days) <-
  "Days in ICU family invited to participate in rounds/conference"
label(demog_desc$family_rounds_icu_days) <-
  "Days in ICU family participated in rounds"
label(demog_desc$family_care_icu_days) <-
  "Days in ICU family participated in plan of care/ABCDEF care"
label(demog_desc$family_edu_icu_days) <-
  "Days in ICU family educated on ABCDEF bundle/related topics"
label(demog_desc$hosp_los) <- "Hospital length of stay"
label(demog_desc$home_posticu) <- "Residence post-ICU"
label(demog_desc$mob_posticu) <- "Mobility post-ICU"
label(demog_desc$dc_status_f) <- "Discharge status"
label(demog_desc$dc_loc_f) <- "Discharge location"
label(demog_desc$comp_a_days) <- "ICU days Element A compliant"
label(demog_desc$comp_a_prop) <- "Proportion of ICU days Element A compliant"
label(demog_desc$perf_a_days) <- "ICU days Element A performed"
label(demog_desc$perf_a_prop) <- "Proportion of ICU days Element A performed"
label(demog_desc$comp_b_sat_days) <- "ICU days Element B - SAT compliant"
label(demog_desc$comp_b_sat_prop) <-
  "Proportion of sedation ICU days Element B - SAT compliant"
label(demog_desc$perf_b_sat_days) <- "ICU days Element B - SAT performed"
label(demog_desc$perf_b_sat_prop) <-
  "Proportion of sedation ICU days Element B - SAT performed"
label(demog_desc$comp_b_sbt_days) <- "ICU days Element B - SBT compliant"
label(demog_desc$comp_b_sbt_prop) <-
  "Proportion of MV ICU days Element B - SBT compliant"
label(demog_desc$perf_b_sbt_days) <- "ICU days Element B - SBT performed"
label(demog_desc$perf_b_sbt_prop) <-
  "Proportion of MV ICU days Element B - SBT performed"
label(demog_desc$comp_c_days) <- "ICU days Element C compliant"
label(demog_desc$comp_c_prop) <- "Proportion of ICU days Element C compliant"
label(demog_desc$perf_c_days) <- "ICU days Element C performed"
label(demog_desc$perf_c_prop) <- "Proportion of ICU days Element C performed"
label(demog_desc$comp_d_days) <- "ICU days Element D compliant"
label(demog_desc$comp_d_prop) <- "Proportion of ICU days Element D compliant"
label(demog_desc$perf_d_days) <- "ICU days Element D performed"
label(demog_desc$perf_d_prop) <- "Proportion of ICU days Element D performed"
label(demog_desc$comp_e_days) <- "ICU days Element E compliant"
label(demog_desc$comp_e_prop) <- "Proportion of ICU days Element E compliant"
label(demog_desc$perf_e_days) <- "ICU days Element E performed"
label(demog_desc$perf_e_prop) <- "Proportion of ICU days Element E performed"
label(demog_desc$comp_f_days) <- "ICU days Element F compliant"
label(demog_desc$comp_f_prop) <-
  "Proportion of family ICU days Element F compliant"
label(demog_desc$perf_f_days) <- "ICU days Element F performed"
label(demog_desc$perf_f_prop) <-
  "Proportion of family ICU days Element F performed"
label(demog_desc$comp_yn_days) <- "ICU days entire bundle compliant"
label(demog_desc$comp_yn_prop) <-
  "Proportion of ICU days entire bundle compliant"
label(demog_desc$perf_yn_days) <- "ICU days entire bundle performed"
label(demog_desc$perf_yn_prop) <-
  "Proportion of ICU days entire bundle performed"

## Only describe days fully in ICU
comp_desc <- compliance %>% filter(icu_day)

label(comp_desc$pain_asmts_icu) <-
  "Number of pain assessments with validated tool"
label(comp_desc$had_painasmt_icu) <-
  "Had >=1 pain assessment with validated tool"
label(comp_desc$comp_a) <- "Element A: compliant"
label(comp_desc$perf_a) <- "Element A: performed"
label(comp_desc$sigpain_verbal_icu) <- "Significant pain self-reported"
label(comp_desc$sigpain_valid_icu) <- "Significant pain using validated tool"
label(comp_desc$sigpain_icu) <- "Significant pain, either method"

label(comp_desc$on_sedation_icu) <- "On continuous/intermittent sedation"
label(comp_desc$had_satscreen_icu) <- "SAT safety screen documented"
label(comp_desc$had_sat_icu) <- "SAT documented"
label(comp_desc$comp_b_sat) <- "Element B - SAT: compliant"
label(comp_desc$perf_b_sat) <- "Element B - SAT: performed"

label(comp_desc$on_mv_icu) <- "On mechanical ventilation"
label(comp_desc$had_sbtscreen_icu) <- "SBT safety screen documented"
label(comp_desc$had_sbt_icu) <- "SBT documented"
label(comp_desc$comp_b_sbt) <- "Element B - SBT: compliant"
label(comp_desc$perf_b_sbt) <- "Element B - SBT: performed"
label(comp_desc$sat_sbt_icu) <- "SAT performed before SBT"

label(comp_desc$sed_assess_valid_icu) <-
  "Number of sedation assessments with validated tool"
label(comp_desc$had_sedasmt_icu) <-
  "Had >=1 sedation assessment with validated tool"
label(comp_desc$comp_c) <- "Element C: compliant"
label(comp_desc$perf_c) <- "Element C: performed"
label(comp_desc$rcvd_benzo_icu) <- "Received benzodiazepines"
label(comp_desc$rcvd_opioid_icu) <- "Received opioids"
label(comp_desc$rcvd_propofol_icu) <- "Received propofol"
label(comp_desc$rcvd_dex_icu) <- "Received dexmedetomidine"

label(comp_desc$del_assess_valid_icu) <-
  "Number of delirium assessments with validated tool"
label(comp_desc$had_delasmt_icu) <-
  "Had >=1 delirium assessment with validated tool"
label(comp_desc$comp_d) <- "Element D: compliant"
label(comp_desc$perf_d) <- "Element D: performed"
label(comp_desc$delirium_icu) <- "Delirious, per validated tool"
label(comp_desc$coma_icu) <- "Comatose"

label(comp_desc$on_restraints_icu) <- "On physical restraints"
label(comp_desc$had_mobscreen_icu) <- "Mobility safety screen documented"
label(comp_desc$had_mobility_icu) <- "Mobility > active ROM documented"
label(comp_desc$mobilityhighest_icu) <- "Highest level of mobility"
label(comp_desc$comp_e) <- "Element E: compliant"
label(comp_desc$perf_e) <- "Element E: performed"

label(comp_desc$family_present_icu) <- "Family present"
label(comp_desc$family_invited_icu) <-
  "Family invited to participate in rounds/conference"
label(comp_desc$family_rounds_icu) <- "Family participated in rounds"
label(comp_desc$family_care_icu) <-
  "Family participated in plan of care/ABCDEF care"
label(comp_desc$family_edu_icu) <-
  "Family educated on ABCDEF bundle/related topics"
label(comp_desc$comp_f) <- "Element F: compliant"
label(comp_desc$perf_f) <- "Element F: performed"

label(comp_desc$comfort_care_icu) <- "On comfort care"

label(comp_desc$comp_yn) <- "Overall ABCDEF compliance"
label(comp_desc$perf_yn) <- "Overall ABCDEF performance"
label(comp_desc$elements_elig) <-
  "Number of ABCDEF elements eligible to be performed/compliant"
label(comp_desc$elements_comp) <- "Number of elements compliant"
label(comp_desc$comp_prop) <- "Proportion of elements compliant"
label(comp_desc$elements_perf) <- "Number of elements performed"
label(comp_desc$perf_prop) <- "Proportion of elements performed"

## Example for percentiles for each table
bmi_quants <- quantile(demog$bmi, na.rm = TRUE)
hrsmv_quants <- quantile(demog$hrs_invas_mv, na.rm = TRUE)
painasmt_quants <- quantile(comp_desc$pain_asmts_icu, na.rm = TRUE)

```

## `r table_nums("descbase")`

Continuous variables are described by the 25th, 50th and 75th percentiles, in
that order (50th percentile = median). For example, 25% of patients had a BMI of
`r round(bmi_quants["25%"])` or less; 50% of patients had a BMI of
`r round(bmi_quants["50%"])` or less; and 75% of patients had a BMI of
`r round(bmi_quants["75%"])` or less.

For full definitions of compliance and performance, see [Definitions](#definitions).

```{r print_descbase}
html(summaryM(age_f + sex_f + race_cat + hisp_cat + bmi + home_preadmit +
                mob_preadmit + primary_admit + icu_type_comb + any_soi +
                apacheii_score + apacheiii_score + apacheiv_score +
                sofa_score ~ 1,
              data = demog_desc,
              continuous = 5),
     what = "%",
     npct = "both",
     digits = 2,
     long = TRUE,
     caption = "Demographic and Baseline Characteristics")

```

## `r table_nums("descinhosp")`

Continuous variables are described by the 25th, 50th and 75th percentiles, in
that order (50th percentile = median). For example, 25% of patients had
`r round(hrsmv_quants["25%"])` or fewer hours on mechanical ventilation; 50% of
patients had `r round(hrsmv_quants["50%"])` or fewer hours on MV; and 75% of
patients had `r round(hrsmv_quants["75%"])` or fewer hours on MV.

For full definitions of compliance and performance, see [Definitions](#definitions).

```{r print_descinhosp}
html(summaryM(ever_invas_mv + hrs_invas_mv + ever_noninvas_mv +
                hrs_noninvas_mv + icu_los + ever_readmit_icu +
                had_painasmt_icu_days + sigpain_icu_days + comp_a_days +
                comp_a_prop + perf_a_days + perf_a_prop +
                on_sedation_icu_days + had_satscreen_icu_days +
                had_sat_icu_days + comp_b_sat_days + comp_b_sat_prop +
                perf_b_sat_days + perf_b_sat_prop +
                on_mv_icu_days + had_sbtscreen_icu_days + had_sbt_icu_days +
                sat_sbt_icu_days + comp_b_sbt_days + comp_b_sbt_prop +
                perf_b_sbt_days + perf_b_sbt_prop +
                had_sedasmt_icu_days + comp_c_days + comp_c_prop + perf_c_days +
                perf_c_prop + rcvd_benzo_icu_days + rcvd_opioid_icu_days +
                rcvd_propofol_icu_days + rcvd_dex_icu_days +
                had_delasmt_icu_days + delirium_icu_days + comp_d_days +
                comp_d_prop + perf_d_days + perf_d_prop +
                had_mobscreen_icu_days + had_mobility_icu_days + comp_e_days +
                comp_e_prop + perf_e_days + perf_e_prop +
                family_present_icu_days + family_invited_icu_days +
                family_rounds_icu_days + family_care_icu_days +
                family_edu_icu_days + comp_f_days + comp_f_prop + perf_f_days +
                perf_f_prop + hosp_los + home_posticu + mob_posticu +
                dc_status_f + dc_loc_f ~ 1,
              data = demog_desc,
              continuous = 5),
     what = "%",
     npct = "both",
     digits = 2,
     long = TRUE,
     caption = "In-Hospital and Discharge Characteristics",
     insert.bottom =
       'Note: "Days in ICU" refers to days the patient was in the ICU all 24h')

```

# Description of ICU Patient-Days

## `r table_nums("descicudays")`

`r table_nums("descicudays", display = "cite")` presents descriptive statistics
by **day** for all days which were completely in the ICU.

Continuous variables are described by the 25th, 50th and 75th percentiles, in
that order (50th percentile = median). For example, 25% of patient-days had
`r round(painasmt_quants["25%"])` or fewer pain assessments with validated
tools; 50% of patient-days had `r round(painasmt_quants["50%"])` or fewer assessments; and 75% of patient-days had `r round(painasmt_quants["75%"])` or
fewer assessments.

For full definitions of compliance and performance, see [Definitions](#definitions).

```{r print_descicudays}
html(summaryM(pain_asmts_icu + had_painasmt_icu + comp_a + perf_a +
                sigpain_verbal_icu + sigpain_valid_icu + sigpain_icu +
                on_sedation_icu + had_satscreen_icu + had_sat_icu + comp_b_sat +
                perf_b_sat + on_mv_icu + had_sbtscreen_icu + had_sbt_icu +
                comp_b_sbt + perf_b_sbt + sat_sbt_icu + sed_assess_valid_icu +
                had_sedasmt_icu + comp_c + perf_c + rcvd_benzo_icu +
                rcvd_opioid_icu + rcvd_propofol_icu + rcvd_dex_icu +
                del_assess_valid_icu + had_delasmt_icu + comp_d + perf_d +
                delirium_icu + coma_icu + on_restraints_icu +
                had_mobscreen_icu + had_mobility_icu + mobilityhighest_icu +
                comp_e + perf_e + family_present_icu + family_invited_icu +
                family_rounds_icu + family_care_icu + family_edu_icu + comp_f +
                perf_f + comfort_care_icu + comp_yn + perf_yn + elements_elig +
                elements_comp + comp_prop + elements_perf + perf_prop ~ 1,
              data = comp_desc,
              continuous = 5),
     what = "%",
     npct = "both",
     digits = 2,
     long = TRUE,
     caption = "Characteristics of ICU Days")

```

