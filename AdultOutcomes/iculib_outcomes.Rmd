---
title: "ICU Liberation: ABCDEF Bundle vs ICU Outcomes"
author: "Jennifer Thompson, MPH for Society of Critical Care Medicine"
output:
  html_notebook:
    code_folding: hide
    theme: journal
    toc: true
    toc_float: true
    toc_depth: 4
---

```{r setup, results = "hide"}
suppressPackageStartupMessages(library(tidyverse, quietly = TRUE))
suppressPackageStartupMessages(library(rms, quietly = TRUE))
suppressPackageStartupMessages(library(captioner, quietly = TRUE))
suppressPackageStartupMessages(library(plotly, quietly = TRUE))
suppressPackageStartupMessages(library(naniar, quietly = TRUE))

load("AnalysisData/iculib.Rdata")

## Combine months 1-6 (baseline); keep implementation months separate
demog$month_cat <- with(demog, {
  factor(ifelse(month_f %in% paste("Month", 1:6), 1,
                as.numeric(gsub("^Month ", "", month_f)) - 5),
         levels = 1:15,
         labels = c("Baseline", paste("Imp", 1:14)))
})
demog$month_cat_short <- with(demog, {
  factor(ifelse(month_f %in% paste("Month", 1:6), 1,
                as.numeric(gsub("^Month ", "", month_f)) - 5),
         levels = 1:15,
         labels = c("BL", paste0("I", 1:14)))
})

compliance$month_cat <- with(compliance, {
  factor(ifelse(month_f %in% paste("Month", 1:6), 1,
                as.numeric(gsub("^Month ", "", month_f)) - 5),
         levels = 1:15,
         labels = c("Baseline", paste("Imp", 1:14)))
})
compliance$month_cat_short <- with(compliance, {
  factor(ifelse(month_f %in% paste("Month", 1:6), 1,
                as.numeric(gsub("^Month ", "", month_f)) - 5),
         levels = 1:15,
         labels = c("BL", paste0("I", 1:14)))
})

## Vector of hex colors from magnifying glass in slide templates
## (via colorcodepicker.com)
magglass_colors <- c("a" = "#E16725",
                     "b" = "#FBA724",
                     "c" = "#698C36",
                     "d" = "#07A7B4",
                     "e" = "#138CBD",
                     "f" = "#293F90",
                     "overall" = "black")

```

```{r tablesfigs, results = "hide"}
table_nums <- captioner(prefix = "Table")
table_nums(
  name = "descbase", caption = "Baseline and Demographic Characteristics"
)
table_nums(
  name = "descinhosp", caption = "In-Hospital and Discharge Characteristics"
)
table_nums(name = "descicudays", caption = "ICU Day Characteristics")
table_nums(
  name = "descabcdef", caption = "Bundle Compliance and Performance, Overall"
)

figure_nums <- captioner(prefix = "Figure")
figure_nums(name = "run_comp", caption = "ABCDEF Compliance Over Time")
figure_nums(name = "run_perf", caption = "ABCDEF Performance Over Time")
figure_nums(name = "run_meds", caption = "Medication Use Over Time")

```

# Overview & Purpose

This report aims to:

1. Describe the cohort of patients in the [SCCM ICU Liberation ABCDEF Bundle Improvement Collaborative](http://www.iculiberation.org/About/collaborative/Pages/default.aspx)
1. Describe the implementation of the [ABCDEF Bundle](http://www.iculiberation.org/Bundles/Pages/default.aspx) over the course of the Collaborative
1. Describe the association between compliance and performance of the ABCDEF Bundle and important ICU outcomes *(outcomes will be detailed in a later section)*

The Collaborative enrolled patients at `r length(unique(demog$hosp_f))` ICUs
across the United States, collecting data during a six-month **baseline** period
and a 14-month **implementation** period. During the six months of baseline data
collection, no changes in usual care were prescribed; during the 14 months of
implementation, sites were encouraged to use the ABCDEF Bundle. Our hypotheses
are that implementation rates improved over the course of data collection, and
that increased compliance with and performance of the ABCDEF Bundle is
associated with better in-hospital outcomes.

Our analysis plan was specified *a priori* and can be found [here](https://docs.google.com/document/d/1GebrA6Lt-rEh70Aw9r4mrhRlggWUfgUl_LaQePOCWZA/edit?usp=sharing), including a history of all changes.

# Definitions of Compliance and Performance {#definitions}

There are six main elements of the ABCDEF Bundle, with element B comprised of
two main components. Definitions of "compliance" (completely following the ABCDEF Bundle protocol as specified, with documentation of each step) and "performance" (performing the main component of the Bundle element, possibly without complete documentation) are detailed below, referring to any single day. For each element,
compliance and performance are only measured if the patient was in the ICU the
full 24 hours; additional eligibility for specific elements are detailed below.

| Bundle element    | Days eligible | Compliant if: | Performed if: |
|-------------------|---------------|---------------|---------------|
| **A: Assess, prevent and manage pain**  | | >=6 documented pain assessments using a validated instrument | *same* |
| **B: Both SAT and SBT** |   |   |   |
| &nbsp;&nbsp;&nbsp;SAT | Received continuous/ intermittent sedation | **If safety screen documented:**<br>If screen failed, SAT not performed; if screen passed, SAT was performed<br>**If safety screen not documented:**<br>SAT marked not done due to  failed screen/contraindication | SAT performed and documented |
| &nbsp;&nbsp;&nbsp;SBT | On mechanical ventilation | **If safety screen documented:**<br>If screen failed, SBT not performed; if screen passed, SBT was performed<br>**If safety screen not documented:**<br>SBT marked not done due to  failed screen/contraindication | SBT performed and documented |
| **C: Choice of analgesia and sedation** | | >=6 documented sedation assessments using a validated instrument | *same* |
| **D: Delirium - assess, prevent and manage** | | >=2 documented delirium assessments using a validated instrument | *same* |
| **E: Exercise and early mobility** | | **If safety screen documented:**<br>If screen failed, mobility not performed; if screen passed, mobility higher than active range of motion was performed<br>**If safety screen not documented:**<br>Mobility marked not done due to failed screen/contraindication | Mobility higher than active range of motion performed and documented |
| **F: Family engagement and empowerment** | Family present | Family member was educated on ABCDEF bundle and/or participated in at least one of: rounds; conference; plan of care; ABCDEF care | *same* |
| **Overall (complete)** | | All elements eligible to be compliant are compliant | All elements eligible to be performed are performed |
| **Overall (dose)** | | Elements compliant / elements eligible to be compliant | Elements performed / elements eligible to be performed |

# Variable Calculation

- **Age:** For descriptive purposes, all age data is left as entered; however,
due to low numbers in our most extreme categories, we combined patients <18 with 18-29-year-olds and patients >90 with 80-89-year-olds in the age variable included in our models.
- **Race:** For descriptive purposes, all race data is left as entered; however,
for modeling, we combined categories with <1% representation. Patients with races of American Indian/Alaskan Native and Native Hawaiian/Pacific Islander are combined, and the very few patients with multiple races marked are combined with patients with "Other" race marked.
- **BMI:** BMI was calculated as `weight / (height / 100)^2`, where weight was entered in kg and height was entered in cm. We assumed that any height below 80 was accidentally entered in inches rather than cm, and converted those heights to cm (original height * 2.54). After calculating BMI, some values were implausible; we assumed that any BMI < 7 (based on anorexia data) or > 204 (based on highest recorded BMI) was due to data entry error, and these values (along with anyone for whom weight and/or height were missing or equal to 0) were forced to be missing.
- **ICU type:** Site self-descriptions were combined as follows:
    - Mixed medical/surgical: *ICU, medical & surgical ICU, critical care unit, adult ICU, adult critical care unit, trauma & life support center*
    - Medical: *medical ICU, medical critical care unit*
    - Surgical/trauma: *surgical ICU, trauma ICU*
    - Neuro: *neuro ICU*
    - Cardiac/surgical: *adult surgical heart unit, cardiac surgical ICU, cardiothoracic ICU, cardiovascular ICU*
    - Cardiac: *cardio-neuro ICU, cardio ICU*
- **Primary admission diagnoses:** Patients could be admitted with multiple admission diagnoses; therefore, we prioritized diagnoses to capture the most important information relevant to this particular project. Diagnoses were categorized and prioritized as following (ie, a patient admitted with both sepsis and pneumonia would be in the sepsis category):
    1. Sepsis/septic shock or ARDS: *sepsis/septic shock; ARDS without infection*
    1. Respiratory: *airway protection/obstruction; COPD/asthma; pneumonia; pulmonary embolism/DVT*
    1. Neurologic: *neurological disease; traumatic brain injury; change in mental status; traumatic brain injury (isolated)*
    1. Cardiac: *congestive heart failure; acute MI/cardiogenic shock; arrhythmia*
    1. Gastrointestinal: *GI bleed; cirrhosis/hepatic failure; pancreatitis*
    1. Genitourinary: *renal failure; metabolic/endocrine/electrolyte disturbances*
    1. Surgery: *vascular; abdominal; transplant; urologic; orthopedic; ENT; OB/GYN*
    1. Trauma: *multi-trauma; hemorrhagic shock*
    1. Drug overdose/withdrawal
    1. Other: *other infectious diseases; malignancy; "other"*

Full details on how many calculated variables are determined from raw data, including definitions of compliance and performance, are in the [analysis plan](https://docs.google.com/document/d/1GebrA6Lt-rEh70Aw9r4mrhRlggWUfgUl_LaQePOCWZA/edit?usp=sharing).

# Descriptive Statistics, Entire Cohort

This section describes all patients enrolled during Months 1-20 of data
collection, including demographics and characteristics at ICU admission,
throughout the hospital stay, and on each patient-day.

**Note: not all these patients can be included in analyses.** All analyses require that patients spend at least one day fully in
the ICU to be included; this reduces the total *potential* N to
`r format(sum(demog$icu_days > 0, na.rm = TRUE), big.mark = ",")` patients.
Specific numbers of patients included in each analysis will be shown as each
model is discussed.

For full definitions of compliance and performance, see [Definitions](#definitions).

```{r descbase}
## Add labels to variables we want to describe - labels don't play well with
## tidyverse so copy a separate data.frame
demog_desc <- demog

demog_desc$hosp_f <- as.factor(demog_desc$hosp_f)

label(demog_desc$hosp_f) <- "Study site"
label(demog_desc$hosp_type) <- "Hospital type"
label(demog_desc$month_cat) <- "Time period"
label(demog_desc$age_f) <- "Age category"
label(demog_desc$sex_f) <- "Sex"
label(demog_desc$race_cat) <- "Race"
label(demog_desc$hisp_cat) <- "Hispanic"
label(demog_desc$bmi) <- "BMI"
label(demog_desc$home_preadmit) <- "Residence pre-admission"
label(demog_desc$mob_preadmit) <- "Mobility pre-admission"
label(demog_desc$primary_admit) <- "Primary admission diagnosis"
label(demog_desc$icu_type_comb) <- "ICU type"
label(demog_desc$any_soi) <- "Any severity of illness score available"
label(demog_desc$apacheii_avail) <- "APACHE II available"
label(demog_desc$apacheii_score) <- "APACHE II score"
label(demog_desc$apacheiii_avail) <- "APACHE III available"
label(demog_desc$apacheiii_score) <- "APACHE III score"
label(demog_desc$apacheiv_avail) <- "APACHE IV available"
label(demog_desc$apacheiv_score) <- "APACHE IV score"
label(demog_desc$sofa_avail) <- "SOFA available"
label(demog_desc$sofa_score) <- "SOFA score"
label(demog_desc$othersoi_avail) <- "Other SOI available"
label(demog_desc$ever_invas_mv) <- "Ever on invasive MV"
label(demog_desc$hrs_invas_mv) <- "Hours on invasive MV"
label(demog_desc$ever_noninvas_mv) <- "Ever on noninvasive MV"
label(demog_desc$hrs_noninvas_mv) <- "Hours on noninvasive MV"
label(demog_desc$icu_los) <- "ICU length of stay"
label(demog_desc$icu_days) <- "Days all 24h in ICU"
label(demog_desc$ever_readmit_icu) <- "Ever readmitted to ICU"
label(demog_desc$had_painasmt_icu_days) <-
  "Days in ICU with >=1 pain assessment with validated tool"
label(demog_desc$sigpain_icu_days) <- "Days in ICU with significant pain"
label(demog_desc$on_sedation_icu_days) <-
  "Days in ICU on continuous/intermittent sedation"
label(demog_desc$had_satscreen_icu_days) <- "Days in ICU with SAT safety screen"
label(demog_desc$had_sat_icu_days) <- "Days in ICU with SAT performed"
label(demog_desc$on_mv_icu_days) <- "Days in ICU on MV"
label(demog_desc$had_sbtscreen_icu_days) <- "Days in ICU with SBT safety screen"
label(demog_desc$had_sbt_icu_days) <- "Days in ICU with SBT performed"
label(demog_desc$sat_sbt_icu_days) <- "Days in ICU with SAT prior to SBT"
label(demog_desc$rcvd_benzo_icu_days) <- "Days received benzodiazepines in ICU"
label(demog_desc$rcvd_opioid_icu_days) <- "Days received opioids in ICU"
label(demog_desc$rcvd_propofol_icu_days) <- "Days received propofol in ICU"
label(demog_desc$rcvd_dex_icu_days) <- "Days received dex in ICU"
label(demog_desc$had_sedasmt_icu_days) <-
  "Days in ICU with >=1 sedation assessment"
label(demog_desc$had_delasmt_icu_days) <-
  "Days in ICU with >=1 delirium assessment"
label(demog_desc$delirium_icu_days) <- "Days in ICU with delirium"
label(demog_desc$had_mobscreen_icu_days) <-
  "Days in ICU with mobility safety screen"
label(demog_desc$had_mobility_icu_days) <-
  "Days in ICU with mobility performed (> active ROM)"
label(demog_desc$family_present_icu_days) <- "Days in ICU with family present"
label(demog_desc$family_invited_icu_days) <-
  "Days in ICU family invited to participate in rounds/conference"
label(demog_desc$family_rounds_icu_days) <-
  "Days in ICU family participated in rounds"
label(demog_desc$family_care_icu_days) <-
  "Days in ICU family participated in plan of care/ABCDEF care"
label(demog_desc$family_edu_icu_days) <-
  "Days in ICU family educated on ABCDEF bundle/related topics"
label(demog_desc$hosp_los) <- "Hospital length of stay"
label(demog_desc$home_posticu) <- "Residence post-ICU"
label(demog_desc$mob_posticu) <- "Mobility post-ICU"
label(demog_desc$dc_status_f) <- "Discharge status"
label(demog_desc$dc_loc_f) <- "Discharge location"
label(demog_desc$comp_a_days) <- "ICU days Element A compliant"
label(demog_desc$comp_a_prop) <- "Proportion of ICU days Element A compliant"
label(demog_desc$perf_a_days) <- "ICU days Element A performed"
label(demog_desc$perf_a_prop) <- "Proportion of ICU days Element A performed"
label(demog_desc$comp_b_sat_days) <- "ICU days Element B - SAT compliant"
label(demog_desc$comp_b_sat_prop) <-
  "Proportion of sedation ICU days Element B - SAT compliant"
label(demog_desc$perf_b_sat_days) <- "ICU days Element B - SAT performed"
label(demog_desc$perf_b_sat_prop) <-
  "Proportion of sedation ICU days Element B - SAT performed"
label(demog_desc$comp_b_sbt_days) <- "ICU days Element B - SBT compliant"
label(demog_desc$comp_b_sbt_prop) <-
  "Proportion of MV ICU days Element B - SBT compliant"
label(demog_desc$perf_b_sbt_days) <- "ICU days Element B - SBT performed"
label(demog_desc$perf_b_sbt_prop) <-
  "Proportion of MV ICU days Element B - SBT performed"
label(demog_desc$comp_c_days) <- "ICU days Element C compliant"
label(demog_desc$comp_c_prop) <- "Proportion of ICU days Element C compliant"
label(demog_desc$perf_c_days) <- "ICU days Element C performed"
label(demog_desc$perf_c_prop) <- "Proportion of ICU days Element C performed"
label(demog_desc$comp_d_days) <- "ICU days Element D compliant"
label(demog_desc$comp_d_prop) <- "Proportion of ICU days Element D compliant"
label(demog_desc$perf_d_days) <- "ICU days Element D performed"
label(demog_desc$perf_d_prop) <- "Proportion of ICU days Element D performed"
label(demog_desc$comp_e_days) <- "ICU days Element E compliant"
label(demog_desc$comp_e_prop) <- "Proportion of ICU days Element E compliant"
label(demog_desc$perf_e_days) <- "ICU days Element E performed"
label(demog_desc$perf_e_prop) <- "Proportion of ICU days Element E performed"
label(demog_desc$comp_f_days) <- "ICU days Element F compliant"
label(demog_desc$comp_f_prop) <-
  "Proportion of family ICU days Element F compliant"
label(demog_desc$perf_f_days) <- "ICU days Element F performed"
label(demog_desc$perf_f_prop) <-
  "Proportion of family ICU days Element F performed"
label(demog_desc$comp_yn_days) <- "ICU days entire bundle compliant"
label(demog_desc$comp_yn_prop) <-
  "Proportion of ICU days entire bundle compliant"
label(demog_desc$perf_yn_days) <- "ICU days entire bundle performed"
label(demog_desc$perf_yn_prop) <-
  "Proportion of ICU days entire bundle performed"

## Only describe days fully in ICU
comp_desc <- compliance %>% filter(icu_day)

label(comp_desc$pain_asmts_icu) <-
  "Number of pain assessments with validated tool"
label(comp_desc$had_painasmt_icu) <-
  "Had >=1 pain assessment with validated tool"
label(comp_desc$comp_a_f) <- "Element A: compliant"
label(comp_desc$perf_a_f) <- "Element A: performed"
label(comp_desc$sigpain_verbal_icu) <- "Significant pain self-reported"
label(comp_desc$sigpain_valid_icu) <- "Significant pain using validated tool"
label(comp_desc$sigpain_icu) <- "Significant pain, either method"

label(comp_desc$on_sedation_icu_f) <- "On continuous/intermittent sedation"
label(comp_desc$had_satscreen_icu) <- "SAT safety screen documented"
label(comp_desc$had_sat_icu) <- "SAT documented"
label(comp_desc$comp_b_sat_f) <- "Element B - SAT: compliant"
label(comp_desc$perf_b_sat_f) <- "Element B - SAT: performed"

label(comp_desc$on_mv_icu_f) <- "On mechanical ventilation"
label(comp_desc$had_sbtscreen_icu) <- "SBT safety screen documented"
label(comp_desc$had_sbt_icu) <- "SBT documented"
label(comp_desc$comp_b_sbt_f) <- "Element B - SBT: compliant"
label(comp_desc$perf_b_sbt_f) <- "Element B - SBT: performed"
label(comp_desc$sat_sbt_icu) <- "SAT performed before SBT"

label(comp_desc$sed_assess_valid_icu) <-
  "Number of sedation assessments with validated tool"
label(comp_desc$had_sedasmt_icu) <-
  "Had >=1 sedation assessment with validated tool"
label(comp_desc$comp_c_f) <- "Element C: compliant"
label(comp_desc$perf_c_f) <- "Element C: performed"
label(comp_desc$rcvd_benzo_icu) <- "Received benzodiazepines"
label(comp_desc$rcvd_opioid_icu) <- "Received opioids"
label(comp_desc$rcvd_propofol_icu) <- "Received propofol"
label(comp_desc$rcvd_dex_icu) <- "Received dexmedetomidine"

label(comp_desc$del_assess_valid_icu) <-
  "Number of delirium assessments with validated tool"
label(comp_desc$had_delasmt_icu) <-
  "Had >=1 delirium assessment with validated tool"
label(comp_desc$comp_d_f) <- "Element D: compliant"
label(comp_desc$perf_d_f) <- "Element D: performed"
label(comp_desc$delirium_icu) <- "Delirious, per validated tool"
label(comp_desc$coma_icu) <- "Comatose"

label(comp_desc$on_restraints_icu) <- "On physical restraints"
label(comp_desc$had_mobscreen_icu) <- "Mobility safety screen documented"
label(comp_desc$had_mobility_icu) <- "Mobility > active ROM documented"
label(comp_desc$mobilityhighest_icu) <- "Highest level of mobility"
label(comp_desc$comp_e_f) <- "Element E: compliant"
label(comp_desc$perf_e_f) <- "Element E: performed"

label(comp_desc$family_present_icu_f) <- "Family present"
label(comp_desc$family_invited_icu) <-
  "Family invited to participate in rounds/conference"
label(comp_desc$family_rounds_icu) <- "Family participated in rounds"
label(comp_desc$family_care_icu) <-
  "Family participated in plan of care/ABCDEF care"
label(comp_desc$family_edu_icu) <-
  "Family educated on ABCDEF bundle/related topics"
label(comp_desc$comp_f_f) <- "Element F: compliant"
label(comp_desc$perf_f_f) <- "Element F: performed"

label(comp_desc$comfort_care_icu) <- "On comfort care"

label(comp_desc$comp_yn_f) <- "Overall ABCDEF compliance"
label(comp_desc$perf_yn_f) <- "Overall ABCDEF performance"
label(comp_desc$elements_elig) <-
  "Number of ABCDEF elements eligible to be performed/compliant"
label(comp_desc$elements_comp) <- "Number of elements compliant"
label(comp_desc$comp_prop) <- "Proportion of elements compliant"
label(comp_desc$elements_perf) <- "Number of elements performed"
label(comp_desc$perf_prop) <- "Proportion of elements performed"

## Example for percentiles for each table
bmi_quants <- quantile(demog$bmi, na.rm = TRUE)
hrsmv_quants <- quantile(demog$hrs_invas_mv, na.rm = TRUE)
painasmt_quants <- quantile(comp_desc$pain_asmts_icu, na.rm = TRUE)

```

## `r table_nums("descbase")`

Continuous variables are described by the 25th, 50th and 75th percentiles, in
that order (50th percentile = median). For example, 25% of patients had a BMI of
`r round(bmi_quants["25%"])` or less; 50% of patients had a BMI of
`r round(bmi_quants["50%"])` or less; and 75% of patients had a BMI of
`r round(bmi_quants["75%"])` or less.

```{r print_descbase}
html(summaryM(hosp_type + month_cat + age_f + sex_f + race_cat +
                hisp_cat + bmi + home_preadmit + mob_preadmit + primary_admit +
                icu_type_comb + any_soi + apacheii_score + apacheiii_score +
                apacheiv_score + sofa_score ~ 1,
              data = demog_desc,
              continuous = 5),
     what = "%",
     npct = "both",
     digits = 2,
     long = TRUE,
     caption = "Demographic and Baseline Characteristics")

```

## `r table_nums("descinhosp")`

Continuous variables are described by the 25th, 50th and 75th percentiles, in
that order (50th percentile = median). For example, 25% of patients had
`r round(hrsmv_quants["25%"])` or fewer hours on mechanical ventilation; 50% of
patients had `r round(hrsmv_quants["50%"])` or fewer hours on MV; and 75% of
patients had `r round(hrsmv_quants["75%"])` or fewer hours on MV.

For full definitions of compliance and performance, see [Definitions](#definitions).

```{r print_descinhosp}
html(summaryM(ever_invas_mv + hrs_invas_mv + ever_noninvas_mv +
                hrs_noninvas_mv + icu_los + ever_readmit_icu +
                had_painasmt_icu_days + sigpain_icu_days + comp_a_days +
                comp_a_prop + perf_a_days + perf_a_prop +
                on_sedation_icu_days + had_satscreen_icu_days +
                had_sat_icu_days + comp_b_sat_days + comp_b_sat_prop +
                perf_b_sat_days + perf_b_sat_prop +
                on_mv_icu_days + had_sbtscreen_icu_days + had_sbt_icu_days +
                sat_sbt_icu_days + comp_b_sbt_days + comp_b_sbt_prop +
                perf_b_sbt_days + perf_b_sbt_prop +
                had_sedasmt_icu_days + comp_c_days + comp_c_prop + perf_c_days +
                perf_c_prop + rcvd_benzo_icu_days + rcvd_opioid_icu_days +
                rcvd_propofol_icu_days + rcvd_dex_icu_days +
                had_delasmt_icu_days + delirium_icu_days + comp_d_days +
                comp_d_prop + perf_d_days + perf_d_prop +
                had_mobscreen_icu_days + had_mobility_icu_days + comp_e_days +
                comp_e_prop + perf_e_days + perf_e_prop +
                family_present_icu_days + family_invited_icu_days +
                family_rounds_icu_days + family_care_icu_days +
                family_edu_icu_days + comp_f_days + comp_f_prop + perf_f_days +
                perf_f_prop + hosp_los + home_posticu + mob_posticu +
                dc_status_f + dc_loc_f ~ 1,
              data = demog_desc,
              continuous = 5),
     what = "%",
     npct = "both",
     digits = 2,
     long = TRUE,
     caption = "In-Hospital and Discharge Characteristics",
     insert.bottom =
       'Note: "Days in ICU" refers to days the patient was in the ICU all 24h')

```

## `r table_nums("descicudays")`

`r table_nums("descicudays", display = "cite")` presents descriptive statistics
by **day** for all days which were completely in the ICU.

Continuous variables are described by the 25th, 50th and 75th percentiles, in
that order (50th percentile = median). For example, 25% of patient-days had
`r round(painasmt_quants["25%"])` or fewer pain assessments with validated
tools; 50% of patient-days had `r round(painasmt_quants["50%"])` or fewer assessments; and 75% of patient-days had `r round(painasmt_quants["75%"])` or
fewer assessments.

For full definitions of compliance and performance, see [Definitions](#definitions).

```{r print_descicudays}
html(summaryM(pain_asmts_icu + had_painasmt_icu + comp_a_f + perf_a_f +
                sigpain_verbal_icu + sigpain_valid_icu + sigpain_icu +
                on_sedation_icu_f + had_satscreen_icu + had_sat_icu +
                comp_b_sat_f + perf_b_sat_f + on_mv_icu_f + had_sbtscreen_icu +
                had_sbt_icu + comp_b_sbt_f + perf_b_sbt_f + sat_sbt_icu +
                sed_assess_valid_icu + had_sedasmt_icu + comp_c_f + perf_c_f +
                rcvd_benzo_icu + rcvd_opioid_icu + rcvd_propofol_icu +
                rcvd_dex_icu + del_assess_valid_icu + had_delasmt_icu +
                comp_d_f + perf_d_f + delirium_icu + coma_icu +
                on_restraints_icu + had_mobscreen_icu + had_mobility_icu +
                mobilityhighest_icu + comp_e_f + perf_e_f +
                family_present_icu_f + family_invited_icu + family_rounds_icu +
                family_care_icu + family_edu_icu + comp_f_f + perf_f_f +
                comfort_care_icu + comp_yn_f + perf_yn_f + elements_elig +
                elements_comp + comp_prop + elements_perf + perf_prop ~ 1,
              data = comp_desc,
              continuous = 5),
     what = "%",
     npct = "both",
     digits = 2,
     long = TRUE,
     caption = "Characteristics of ICU Days")

```

# ABCDEF Implementation & Drug Use Over Time

The following runcharts present rates of ABCDEF Bundle compliance and
performance, both overall and by individual element, over the course of data
collection, as well as rates of sedative and analgesic use. Months 1-6 are
grouped together as our Baseline period; Months 7-20 are shown individually.
Numerators and denominators for each point can be seen in tooltips (hover over
the point of interest). For full definitions of compliance and performance, see
[Definitions](#definitions).

```{r runchart_prep}
## -- Elements common to both runcharts ----------------------------------------
element_suffixes <- c("a", "b_sat", "b_sbt", "c", "d", "e", "f", "yn")
element_tracenames <- c("A", "B: SAT", "B: SBT", "C", "D", "E", "F", "Overall")
element_cols <- c("a", "b", "b", "c", "d", "e", "f", "overall")

## Create list of plot titles, X/Y coordinates
runchart_titles <- c("A: Assess, prevent, manage pain",
                     "B: SAT",
                     "B: SBT",
                     "C: Choice of analgesia & sedation",
                     "D: Delirium",
                     "E: Exercise/early mobility",
                     "F: Family",
                     "Entire ABCDEF Bundle")

runchart_xes <- c(0.01, 0.27, 0.52, rep(0.77, 4), 0.02)
runchart_ys <- c(rep(0.24, 3), 1.05, 0.775, 0.54, 0.24, 1.05)
runchart_titlesize <- c(rep(8, 7), 12)

## Create list of annotations - will substitute for plot titles
## (plotly will only allow one title per plot, not one per subplot)
make_annotate_item <- function(title, title_size, xval, yval){
  list(x = xval, xanchor = "left", xref = "paper",
       y = yval, yanchor = "top", yref = "paper",
       text = paste0("<b>", title, "</b>"),
       font = list(size = title_size, family = "sans-serif"),
       showarrow = FALSE)
}

title_list <- pmap(.l = list("title" = runchart_titles,
                             "title_size" = runchart_titlesize,
                             "xval" = runchart_xes,
                             "yval" = runchart_ys),
                   .f = make_annotate_item)

## -- Function to create a plotly object for each element/overall --------------
create_plotly_runchart <- function(df, tracename, tracecol){
  if(tracename == "Overall"){
    ts <- 18
    fs <- 10
    tvals <- c("BL", paste0("I", 1:14))
    ms <- 6
  } else{
    ts <- 14
    fs <- 6
    tvals <- c("BL", paste0("I", seq(1, 13, 2)))
    ms <- 4
  }

  plot_ly(
    data = df,
    x = ~ month_cat_short,
    y = ~ pct_yes,
    name = tracename,
    line = list(color = magglass_colors[tracecol]),
    marker = list(color = magglass_colors[tracecol], size = ms),
    text = ~ tt_text,
    type = "scatter",
    mode = "lines+markers"
  ) %>%
    layout(titlefont = list(size = ts),
           xaxis = list(title = "",
                        tickfont = list(size = fs),
                        tickmode = "array",
                        tickvals = tvals),
           yaxis = list(title = "% Eligible Days",
                        range = c(0, 100),
                        tickmode = "array",
                        tickvals = seq(0, 100, 25),
                        ticksuffix = "%",
                        tickfont = list(size = fs)),
           font = list(family = "sans-serif"),
           showlegend = FALSE)
}

## Wrapper function to avoid tidyeval
filter_and_plot <- function(el, name, col, df){
  filter(df, element == el) %>%
    create_plotly_runchart(tracename = name, tracecol = col)
}

## -- Compliance runcharts -----------------------------------------------------
## Create dataset for overall compliance (y/n)
comp_yn_data <- compliance %>%
  dplyr::select(month_cat_short,
                ## Denominators
                icu_day, on_sedation_icu, on_mv_icu,
                family_present_icu, elements_elig,
                ## Numerators
                paste0("comp_", element_suffixes), elements_comp) %>%
  group_by(month_cat_short) %>%
  summarise_all(funs(days = sum), na.rm = TRUE) %>%
  ungroup() %>%
  gather(key = element, value = comp_days, comp_a_days:elements_comp_days) %>%
  mutate(elig_days =
           case_when(element == "comp_b_sat_days" ~ on_sedation_icu_days,
                     element == "comp_b_sbt_days" ~ on_mv_icu_days,
                     element == "comp_f_days" ~ family_present_icu_days,
                     element == "elements_comp_days" ~
                       as.integer(elements_elig_days),
                     TRUE ~ icu_day_days),
         pct_yes = round((comp_days / elig_days) * 100),
         dose_yn = ifelse(element == "elements_comp_days", " dose", ""),
         elig_text =
           case_when(element == "comp_b_sat_days" ~ "ICU days on sedation",
                     element == "comp_b_sbt_days" ~ "ICU days on MV",
                     element == "comp_f_days" ~ "ICU days family present",
                     element == "elements_comp_days" ~ "Elements eligible",
                     TRUE ~ "ICU days"),
         eldays_text = ifelse(element == "elements_comp_days",
                              "Elements", "Days"),
         tt_text = sprintf("Compliance%s: %s%%<br>%s compliant: %s<br>%s: %s",
                           dose_yn, round(pct_yes), eldays_text, comp_days,
                           elig_text, elig_days))

## Create list of all plots
comp_elements <- unique(comp_yn_data$element)
comp_elements <- comp_elements[grep("^comp", comp_elements)]

comp_plots <- purrr::pmap(
  list("el" = comp_elements, "name" = element_tracenames, "col" = element_cols),
  filter_and_plot,
  df = comp_yn_data
)
names(comp_plots) <- comp_elements

## Add a trace for "dose" to overall plot
comp_plots$comp_yn_days <- comp_plots$comp_yn_days %>%
  add_trace(
    data = filter(comp_yn_data, element == "elements_comp_days"),
    x = ~ month_cat_short,
    y = ~ pct_yes,
    name = "Dose of compliance",
    line = list(color = "black", dash = "dot"),
    marker = list(color = "black", size = 6),
    text = ~ tt_text,
    type = "scatter",
    mode = "lines+markers"
  )

## Make one big plot using subplots
## Overall --- C
## Overall --- D
## Overall --- E
## A BSAT BSBT F

comp_horiz <- subplot(comp_plots$comp_a_days, comp_plots$comp_b_sat_days,
                      comp_plots$comp_b_sbt_days, comp_plots$comp_f_days,
                      nrows = 1, shareY = TRUE, margin = 0.01)
comp_vert <- subplot(comp_plots$comp_c_days, comp_plots$comp_d_days,
                     comp_plots$comp_e_days,
                     nrows = 3, shareX = TRUE, margin = 0.04) %>%
  layout(xaxis = list(showticklabels = FALSE))
comp_toprow <- subplot(comp_plots$comp_yn_days, comp_vert,
                       nrows = 1, widths = c(0.75, 0.25))

plotly_comp <- subplot(comp_toprow, comp_horiz,
                       nrows = 2, heights = c(0.75, 0.25), margin = 0.05)

## -- Performance runcharts ----------------------------------------------------
## Create dataset for overall performance (y/n)
perf_yn_data <- compliance %>%
  dplyr::select(month_cat_short,
                ## Denominators
                icu_day, on_sedation_icu, on_mv_icu,
                family_present_icu, elements_elig,
                ## Numerators
                paste0("perf_", element_suffixes), elements_perf) %>%
  group_by(month_cat_short) %>%
  summarise_all(funs(days = sum), na.rm = TRUE) %>%
  ungroup() %>%
  gather(key = element, value = perf_days, perf_a_days:elements_perf_days) %>%
  mutate(elig_days =
           case_when(element == "perf_b_sat_days" ~ on_sedation_icu_days,
                     element == "perf_b_sbt_days" ~ on_mv_icu_days,
                     element == "perf_f_days" ~ family_present_icu_days,
                     element == "elements_perf_days" ~
                       as.integer(elements_elig_days),
                     TRUE ~ icu_day_days),
         pct_yes = round((perf_days / elig_days) * 100),
         dose_yn = ifelse(element == "elements_perf_days", " dose", ""),
         elig_text =
           case_when(element == "perf_b_sat_days" ~ "ICU days on sedation",
                     element == "perf_b_sbt_days" ~ "ICU days on MV",
                     element == "perf_f_days" ~ "ICU days family present",
                     element == "elements_perf_days" ~ "Elements eligible",
                     TRUE ~ "ICU days"),
         eldays_text = ifelse(element == "elements_perf_days",
                              "Elements", "Days"),
         tt_text = sprintf("Performance%s: %s%%<br>%s performed: %s<br>%s: %s",
                           dose_yn, round(pct_yes), eldays_text, perf_days,
                           elig_text, elig_days))

## Create list of all plots
perf_elements <- unique(perf_yn_data$element)
perf_elements <- perf_elements[grep("^perf", perf_elements)]

perf_plots <- purrr::pmap(
  list("el" = perf_elements, "name" = element_tracenames, "col" = element_cols),
  filter_and_plot,
  df = perf_yn_data
)
names(perf_plots) <- perf_elements

## Add a trace for "dose" to overall plot
perf_plots$perf_yn_days <- perf_plots$perf_yn_days %>%
  add_trace(
    data = filter(perf_yn_data, element == "elements_perf_days"),
    x = ~ month_cat_short,
    y = ~ pct_yes,
    name = "Dose of performance",
    line = list(color = "black", dash = "dot"),
    marker = list(color = "black", size = 6),
    text = ~ tt_text,
    type = "scatter",
    mode = "lines+markers"
  )

## Make one big plot using subplots
perf_horiz <- subplot(perf_plots$perf_a_days, perf_plots$perf_b_sat_days,
                      perf_plots$perf_b_sbt_days, perf_plots$perf_f_days,
                      nrows = 1, shareY = TRUE, margin = 0.01)
perf_vert <- subplot(perf_plots$perf_c_days, perf_plots$perf_d_days,
                     perf_plots$perf_e_days,
                     nrows = 3, shareX = TRUE, margin = 0.04) %>%
  layout(xaxis = list(showticklabels = FALSE))
perf_toprow <- subplot(perf_plots$perf_yn_days, perf_vert,
                       nrows = 1, widths = c(0.75, 0.25))

plotly_perf <- subplot(perf_toprow, perf_horiz,
                       nrows = 2, heights = c(0.75, 0.25), margin = 0.05)

```

## `r figure_nums("run_comp")`

For overall compliance, the dotted line indicates **dose** of compliance; the
solid line indicates total (yes/no) compliance.

```{r print_comprun, fig.width = 7, fig.height = 5}
plotly_comp %>%
  layout(annotations = title_list)

```

## `r figure_nums("run_perf")`

For overall performance, the dotted line indicates **dose** of performance; the
solid line indicates total (yes/no) performance.

```{r print_perfrun, fig.width = 7, fig.height = 5}
plotly_perf %>%
  layout(annotations = title_list)

```

## `r figure_nums("run_meds")`

`r figure_nums("run_meds", display = "cite")` shows the percentage of ICU days
with each medication used over time.

```{r runchart_meds, fig.width = 7, fig.height = 5}
## Vector of medication names
med_names <- c("Benzodiazepines", "Opioids", "Propofol", "Dexmedetomidine")

prop_yes <- function(x){
  mean(x == "Yes", na.rm = TRUE) * 100
}
days_yes <- function(x){
  sum(x == "Yes", na.rm = TRUE)
}

## Note: Tried to also do % of days on continuous/intermittent sedation,
## but proportions were >1, I assume because patients received these medications
## PRN as well as continuously.

rundata_meds <- compliance %>%
  filter(icu_day) %>%
  dplyr::select(month_cat_short, matches("^rcvd\\_[a-z]+\\_icu$")) %>%
  group_by(month_cat_short) %>%
  summarise_all(funs(days = days_yes)) %>%
  ungroup() %>%
  gather(key = med, value = days_med, matches("^rcvd")) %>%
  left_join(
    distinct(dplyr::select(comp_yn_data, month_cat_short, icu_day_days)),
    by = "month_cat_short") %>%
  mutate(
    med = gsub("^rcvd\\_", "", gsub("\\_icu\\_days$", "", med)),
    med_f = case_when(med == "benzo" ~ "Benzodiazepines",
                      med == "dex" ~ "Dexmedetomidine",
                      med == "opioid" ~ "Opioids",
                      med == "propofol" ~ "Propofol",
                      TRUE ~ "Other"),
    prop_med = round((days_med / icu_day_days) * 100),
    tt_text = sprintf("Received on %s / %s ICU days", days_med, icu_day_days)
  )

## -- Function to create a plotly object for each medication -------------------
create_plotly_medchart <- function(df = rundata_meds, tracename, tracecol){
  df <- df %>% filter(med_f == tracename)
  
  ts <- 14
  fs <- 10
  tvals <- c("BL", paste0("I", seq(1, 13, 2)))
  ms <- 4

  plot_ly(
    data = df,
    x = ~ month_cat_short,
    y = ~ prop_med,
    name = tracename,
    line = list(color = magglass_colors[tracecol]),
    marker = list(color = magglass_colors[tracecol], size = ms),
    text = ~ tt_text,
    type = "scatter",
    mode = "lines+markers"
  ) %>%
    layout(titlefont = list(size = ts),
           xaxis = list(title = "",
                        tickfont = list(size = fs),
                        tickmode = "array",
                        tickvals = tvals),
           yaxis = list(title = "% ICU Days",
                        range = c(0, 100),
                        tickmode = "array",
                        tickvals = seq(0, 100, 25),
                        ticksuffix = "%",
                        tickfont = list(size = fs)),
           font = list(family = "sans-serif"),
           showlegend = FALSE)
}

runchart_med_args <- list(
  "tracename" = med_names, "tracecol" = c("b", "c", "d", "f")
)

runcharts_meds <- pmap(.l = runchart_med_args, .f = create_plotly_medchart)
names(runcharts_meds) <- med_names

runchart_meds <- subplot(
  runcharts_meds,
  nrows = 2,
  shareX = TRUE, shareY = TRUE,
  titleX = FALSE,
  margin = c(0.01, 0.01, 0.05, 0.05)
)

## Create list of plot titles, X/Y coordinates
runchart_meds_xes <- c(0.01, 0.51, 0.01, 0.51)
runchart_meds_ys <- c(1.05, 1.05, 0.51, 0.51)

med_title_list <- pmap(.l = list("title" = med_names,
                             "xval" = runchart_meds_xes,
                             "yval" = runchart_meds_ys),
                   .f = make_annotate_item,
                   title_size = 14)

runchart_meds %>% layout(annotations = med_title_list)

```

# Missing Data Characteristics: "ABCDEF Bundle vs ___ Tomorrow" Models

Several of our aims involve looking at measures of ABCDEF bundle compliance and
performance on a given day vs some outcome the following day. For example, these
models will help us answer the question "Among patients still alive and in the ICU, is total ABCDEF bundle compliance on a given ICU day associated with lower
likelihood of being on mechanical ventilation the following day?"

```{r model_datamgmt}
## -- Create data set for all "vs XXX the following day" models ----------------
## Vector of variables for which we'll need "xxx tomorrow" versions
lead_vars <- c("icu_day", "on_mv_icu_f", "coma_icu", "on_restraints_icu",
               "sigpain_icu", "delirium_icu")

## Vector of baseline covariates
base_vars <- c("age_cat_mod", "race_cat_mod", "hisp_cat_mod", "bmi",
               "mob_preadmit", "primary_admit", "home_preadmit", "icu_type",
               "hosp_type")

df_logmods <- compliance %>%
  dplyr::select(id, icu_day, redcap_event_name_f,
                comfort_care_icu, on_sedation_icu_f, rcvd_benzo_icu,
                rcvd_opioid_icu, rcvd_propofol_icu, rcvd_dex_icu,
                rcvd_antipsyc_icu,
                on_mv_icu_f, coma_icu,
                on_restraints_icu, sigpain_icu, delirium_icu,
                comp_yn_f, perf_yn_f, comp_prop, perf_prop) %>%
  ## Create "tomorrow" variables
  group_by(id) %>%
  mutate_at(vars(one_of(lead_vars)), funs(tmw = lead)) %>%
  ungroup() %>%
  ## Filter - these models will only use days when patients were in the ICU
  ## both "today" and "tomorrow"
  filter(icu_day & icu_day_tmw) %>%
  ## Merge on baseline covariates
  right_join(dplyr::select(demog, id, one_of(base_vars)), ., by = "id")

## To describe missingness, get only baseline variables for only patients with
##   >=2 consecutive ICU days
df_logmods_baseline <- df_logmods %>%
  dplyr::select(id, one_of(base_vars)) %>%
  distinct()

# ## Check a few patients
# ckids <- sample(unique(compliance$id), size = 10)
# print_vars <- map(lead_vars, ~ c(., paste0(., "_tmw"))) %>% flatten_chr
# print(subset(df_logmods, id %in% ckids)[,c("id", "redcap_event_name_f",
#                                            print_vars)],
#       width = Inf)

npts_total <- length(unique(demog$id))
npts_modeldays <- length(unique(df_logmods$id))
pctpts_modeldays <- (npts_modeldays / npts_total) * 100

# ## Common sense check for % patients included in these models
# ck_icudays <- compliance %>%
#   group_by(id) %>%
#   summarise(n_icu_days = sum(icu_day, na.rm = TRUE)) %>%
#   ungroup()

```

We started with `r format(npts_total, big.mark = ",")` patients enrolled in the Collaborative; among these, only `r format(npts_modeldays, big.mark = ",")` (`r round(pctpts_modeldays)`%) had two consecutive days fully in the ICU and will thus have at least one record included in this set of models. **Note:** models with delirium as an outcome will have even fewer patients, due to sparseness of
data collection for this outcome.

## Missingness for Baseline/Demographic Variables

Among patients included in these logistic models, most baseline variables had
low rates of missingness, with the exception of mobility status prior to Collaborative admission (`r round(mean(is.na(df_logmods_baseline$mob_preadmit)) * 100)`% missing). A reference line at 5% missingness is included below;
below this level, we typically don't worry much about missingness.

```{r logmods_missing_baseline}
gg_miss_var(df_logmods_baseline %>% dplyr::select(-id), show_pct = TRUE) +
  geom_hline(yintercept = 5, color = "grey50", linetype = "dotted")

```

## Missingness for Daily Variables

Missingness for each model covariate and/or outcome is shown below among the
`r nrow(df_logmods)` patient-days eligible to be included in this set of models.
Delirium has by far the most missingness, indicating that delirium was just not
assessed in this group of patients as often as we'd like. Coma and significant pain - other variables which require assessments - have the next highest rates
of missingness, though much lower than delirium. All other model covariates had
low rates of missingness. A reference line at 5% missingness is included below;
below this level, we typically don't worry much about missingness.

```{r logmods_missing_daily}
gg_miss_var(df_logmods %>% dplyr::select(-id, -one_of(base_vars)),
            show_pct = TRUE) +
  geom_hline(yintercept = 5, color = "grey50", linetype = "dotted")

```

## Strategy for Handling Missingness

Often, we would use multiple imputation to handle missingness of a concerning amount; however, this method's effectiveness depends on the *available* data to reliably predict missing values. For the following reasons, we are choosing to limit are analyses to complete cases and not perform multiple imputation:

- We are missing some key information (eg, severity of illness) which would help predict missing values.
- In longitudinal data analysis, multiple imputation for both baseline (ie, should be the same value for every patient) and time-varying (can change daily) variables is complex and time-consuming.
- Our rates of missingness are generally low, with a few exceptions as noted.

The drawback of complete case analysis is that our results could be biased due to differences in the patients we would *like* to include and patients we are *able* to include. For example, if patients who are sicker are more likely to have delirium assessed on a given day, then the patient population we are able to include in our delirium models is sicker than the population we would ideally generalize to.

Therefore, we compare available data on the patients and patient-days who **do** and **do not** have complete outcome and covariate data. Because there is so
much missing delirium data, we will include missingness both considering and
ignoring delirium.

**Summary**: Whether or not delirium was considered, patients with complete data tended to be slightly older, of white race (vs other/multiple races), and non-Hispanic, with slightly more restricted mobility and lower likelihood of being home prior to admission. They were slightly more likely to be admitted for surgery or sepsis and slightly less likely to be admitted for trauma. None of
these differences seem large enough to be terribly concerning.

Patient-days with complete data tended to have higher rates of opioid use and lower rates of propofol use; lower use of restraints; higher rates of significant pain; and lower rates of MV and coma. They also tended to have more ABCDEF bundle compliance and performance. These differences are more likely to bias our
results than baseline/demographic differences.

## Detail of Differences between Patient-Days with Missing vs Complete Data

Further details are included below for reference. In figures, black dots indicate at least some missing data, while white dots indicate complete data.

```{r logmods_compare_missing_prep}
## -- Create indicators for missingness among outcomes (with/without -----------
## -- delirium), covariates, overall (with/without delirium) -------------------
df_compmissing <- df_logmods
df_compmissing$comp_outcomes <-
  rowSums(is.na(df_compmissing[,c("delirium_icu_tmw", "coma_icu_tmw",
                                  "sigpain_icu_tmw", "on_mv_icu_f_tmw")])) == 0
df_compmissing$comp_outcomes_nodel <-
  rowSums(is.na(df_compmissing[,c("sigpain_icu_tmw", "on_mv_icu_f_tmw")])) == 0
df_compmissing$comp_covars <-
  rowSums(is.na(df_compmissing[,c(2:10, 13, 15:23, 25:28)])) == 0

df_compmissing$comp_data <- with(df_compmissing, comp_outcomes & comp_covars)
df_compmissing$comp_data_f <- with(df_compmissing, {
  factor(as.numeric(comp_data),
         levels = 0:1,
         labels = c("Complete data", "Missing data"))
})

df_compmissing$comp_data_nodel <-
  with(df_compmissing, comp_outcomes_nodel & comp_covars)
df_compmissing$comp_data_nodel_f <- with(df_compmissing, {
  factor(as.numeric(comp_data_nodel),
         levels = 0:1,
         labels = c("Complete data", "Missing data"))
})

```

```{r logmods_compare_missing_incdel, fig.height = 4, fig.width = 7}
summarize_missing_incdel <- 
  summaryM(age_cat_mod + race_cat_mod + hisp_cat_mod + bmi + mob_preadmit +
             primary_admit + home_preadmit + hosp_type +
             comfort_care_icu + rcvd_benzo_icu + rcvd_opioid_icu +
             rcvd_propofol_icu + rcvd_dex_icu + rcvd_antipsyc_icu +
             on_restraints_icu + sigpain_icu + on_mv_icu_f + coma_icu +
             delirium_icu +
             comp_yn_f + comp_prop + perf_yn_f + perf_prop ~
             comp_data_f,
           data = df_compmissing)

html(summarize_missing_incdel,
     what = "%",
     digits = 2,
     long = TRUE,
     npct = "both",
     prmsd = TRUE, brmsd = TRUE,
     caption = "Characteristics of patients with missing vs complete data, including delirium outcome")

plot.summaryM(summarize_missing_incdel)

```

```{r logmods_compare_missing_notincdel, fig.height = 4, fig.width = 7}
summarize_missing_notincdel <-
  summaryM(age_cat_mod + race_cat_mod + hisp_cat_mod + bmi + mob_preadmit +
             primary_admit + home_preadmit + hosp_type +
             comfort_care_icu + rcvd_benzo_icu + rcvd_opioid_icu +
             rcvd_propofol_icu + rcvd_dex_icu + rcvd_antipsyc_icu +
             on_restraints_icu + sigpain_icu + on_mv_icu_f + coma_icu +
             delirium_icu +
             comp_yn_f + comp_prop + perf_yn_f + perf_prop ~
             comp_data_nodel_f,
           data = df_compmissing)

html(summarize_missing_notincdel,
     what = "%",
     digits = 2,
     long = TRUE,
     npct = "both",
     prmsd = TRUE, brmsd = TRUE,
     caption = "Characteristics of patients with missing vs complete data, ignoring delirium outcome")

plot.summaryM(summarize_missing_notincdel)

```
